/* This file has been generated from /home/lsk/paparazzi/conf/airframes/examples/krooz_sd/krooz_sd_quad_pwm1.xml */
/* Please DO NOT EDIT */

#ifndef AIRFRAME_H
#define AIRFRAME_H

#define AIRFRAME_NAME "kroozsd_lsk"
#define AC_ID 1
#define MD5SUM ((uint8_t*)"\301\211\144\201\261\227\175\100\162\357\043\264\134\321\036\147")

#define SERVOS_PWM_NB 4
#include "subsystems/actuators/actuators_pwm.h"

#define SERVO_NE 0
#define SERVO_NE_NEUTRAL 1190
#define SERVO_NE_TRAVEL_UP 0.0739583333333
#define SERVO_NE_TRAVEL_UP_NUM 71
#define SERVO_NE_TRAVEL_UP_DEN 960
#define SERVO_NE_TRAVEL_DOWN 0.0197916666667
#define SERVO_NE_TRAVEL_DOWN_NUM 19
#define SERVO_NE_TRAVEL_DOWN_DEN 960
#define SERVO_NE_MAX 1900
#define SERVO_NE_MIN 1000

#define SERVO_SE 1
#define SERVO_SE_NEUTRAL 1190
#define SERVO_SE_TRAVEL_UP 0.0739583333333
#define SERVO_SE_TRAVEL_UP_NUM 71
#define SERVO_SE_TRAVEL_UP_DEN 960
#define SERVO_SE_TRAVEL_DOWN 0.0197916666667
#define SERVO_SE_TRAVEL_DOWN_NUM 19
#define SERVO_SE_TRAVEL_DOWN_DEN 960
#define SERVO_SE_MAX 1900
#define SERVO_SE_MIN 1000

#define SERVO_SW 2
#define SERVO_SW_NEUTRAL 1190
#define SERVO_SW_TRAVEL_UP 0.0739583333333
#define SERVO_SW_TRAVEL_UP_NUM 71
#define SERVO_SW_TRAVEL_UP_DEN 960
#define SERVO_SW_TRAVEL_DOWN 0.0197916666667
#define SERVO_SW_TRAVEL_DOWN_NUM 19
#define SERVO_SW_TRAVEL_DOWN_DEN 960
#define SERVO_SW_MAX 1900
#define SERVO_SW_MIN 1000

#define SERVO_NW 3
#define SERVO_NW_NEUTRAL 1190
#define SERVO_NW_TRAVEL_UP 0.0739583333333
#define SERVO_NW_TRAVEL_UP_NUM 71
#define SERVO_NW_TRAVEL_UP_DEN 960
#define SERVO_NW_TRAVEL_DOWN 0.0197916666667
#define SERVO_NW_TRAVEL_DOWN_NUM 19
#define SERVO_NW_TRAVEL_DOWN_DEN 960
#define SERVO_NW_MAX 1900
#define SERVO_NW_MIN 1000


#define COMMAND_ROLL 0
#define COMMAND_PITCH 1
#define COMMAND_YAW 2
#define COMMAND_THRUST 3
#define COMMANDS_NB 4
#define COMMANDS_FAILSAFE {0,0,0,0}


#define SERVO_SE_IDX 1
#define Set_SE_Servo(_v) { \
  actuators[SERVO_SE_IDX] = Chop(_v, SERVO_SE_MIN, SERVO_SE_MAX); \
  ActuatorPwmSet(SERVO_SE, actuators[SERVO_SE_IDX]); \
}

#define SERVO_NW_IDX 3
#define Set_NW_Servo(_v) { \
  actuators[SERVO_NW_IDX] = Chop(_v, SERVO_NW_MIN, SERVO_NW_MAX); \
  ActuatorPwmSet(SERVO_NW, actuators[SERVO_NW_IDX]); \
}

#define SERVO_SW_IDX 2
#define Set_SW_Servo(_v) { \
  actuators[SERVO_SW_IDX] = Chop(_v, SERVO_SW_MIN, SERVO_SW_MAX); \
  ActuatorPwmSet(SERVO_SW, actuators[SERVO_SW_IDX]); \
}

#define SERVO_NE_IDX 0
#define Set_NE_Servo(_v) { \
  actuators[SERVO_NE_IDX] = Chop(_v, SERVO_NE_MIN, SERVO_NE_MAX); \
  ActuatorPwmSet(SERVO_NE, actuators[SERVO_NE_IDX]); \
}

#define ACTUATORS_NB 4

#define AllActuatorsInit() { \
  ActuatorsPwmInit();\
}

#define AllActuatorsCommit() { \
  ActuatorsPwmCommit();\
}

#define SetActuatorsFromCommands(values, AP_MODE) { \
  int32_t servo_value;\
  int32_t command_value;\
\
  motor_mixing_run(autopilot_motors_on,FALSE,values); \
\
  command_value = motor_mixing.commands[0]; \
  command_value *= command_value>0 ? SERVO_NE_TRAVEL_UP_NUM : SERVO_NE_TRAVEL_DOWN_NUM; \
  command_value /= command_value>0 ? SERVO_NE_TRAVEL_UP_DEN : SERVO_NE_TRAVEL_DOWN_DEN; \
  servo_value = SERVO_NE_NEUTRAL + command_value; \
  Set_NE_Servo(servo_value); \
\
  command_value = motor_mixing.commands[1]; \
  command_value *= command_value>0 ? SERVO_SE_TRAVEL_UP_NUM : SERVO_SE_TRAVEL_DOWN_NUM; \
  command_value /= command_value>0 ? SERVO_SE_TRAVEL_UP_DEN : SERVO_SE_TRAVEL_DOWN_DEN; \
  servo_value = SERVO_SE_NEUTRAL + command_value; \
  Set_SE_Servo(servo_value); \
\
  command_value = motor_mixing.commands[2]; \
  command_value *= command_value>0 ? SERVO_SW_TRAVEL_UP_NUM : SERVO_SW_TRAVEL_DOWN_NUM; \
  command_value /= command_value>0 ? SERVO_SW_TRAVEL_UP_DEN : SERVO_SW_TRAVEL_DOWN_DEN; \
  servo_value = SERVO_SW_NEUTRAL + command_value; \
  Set_SW_Servo(servo_value); \
\
  command_value = motor_mixing.commands[3]; \
  command_value *= command_value>0 ? SERVO_NW_TRAVEL_UP_NUM : SERVO_NW_TRAVEL_DOWN_NUM; \
  command_value /= command_value>0 ? SERVO_NW_TRAVEL_UP_DEN : SERVO_NW_TRAVEL_DOWN_DEN; \
  servo_value = SERVO_NW_NEUTRAL + command_value; \
  Set_NW_Servo(servo_value); \
\
  AllActuatorsCommit(); \
}

#define SECTION_MIXING 1
#define MOTOR_MIXING_TRIM_ROLL 0
#define MOTOR_MIXING_TRIM_PITCH 0
#define MOTOR_MIXING_TRIM_YAW 0
#define MOTOR_MIXING_NB_MOTOR 4
#define MOTOR_MIXING_SCALE 512
#define MOTOR_MIXING_ROLL_COEF {-MOTOR_MIXING_SCALE, -MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE }
#define MOTOR_MIXING_PITCH_COEF { MOTOR_MIXING_SCALE, -MOTOR_MIXING_SCALE, -MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE }
#define MOTOR_MIXING_YAW_COEF { -MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE, -MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE  }
#define MOTOR_MIXING_THRUST_COEF {  MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE, MOTOR_MIXING_SCALE  }

#define SECTION_IMU 1
#define IMU_GYRO_P_NEUTRAL 0
#define IMU_GYRO_Q_NEUTRAL 0
#define IMU_GYRO_R_NEUTRAL 0
#define IMU_GYRO_P_SENS 0.5454
#define IMU_GYRO_P_SENS_NUM 2727
#define IMU_GYRO_P_SENS_DEN 5000
#define IMU_GYRO_Q_SENS 0.5454
#define IMU_GYRO_Q_SENS_NUM 2727
#define IMU_GYRO_Q_SENS_DEN 5000
#define IMU_GYRO_R_SENS 0.5454
#define IMU_GYRO_R_SENS_NUM 2727
#define IMU_GYRO_R_SENS_DEN 5000
#define IMU_ACCEL_X_NEUTRAL -88
#define IMU_ACCEL_Y_NEUTRAL 276
#define IMU_ACCEL_Z_NEUTRAL -1092
#define IMU_ACCEL_X_SENS 0.615613269173
#define IMU_ACCEL_X_SENS_NUM 36243
#define IMU_ACCEL_X_SENS_DEN 58873
#define IMU_ACCEL_Y_SENS 0.608035621133
#define IMU_ACCEL_Y_SENS_NUM 23351
#define IMU_ACCEL_Y_SENS_DEN 38404
#define IMU_ACCEL_Z_SENS 0.602379554762
#define IMU_ACCEL_Z_SENS_NUM 4101
#define IMU_ACCEL_Z_SENS_DEN 6808
#define IMU_MAG_X_NEUTRAL -89
#define IMU_MAG_Y_NEUTRAL 586
#define IMU_MAG_Z_NEUTRAL -1247
#define IMU_MAG_X_SENS 5.4750484789
#define IMU_MAG_X_SENS_NUM 53650
#define IMU_MAG_X_SENS_DEN 9799
#define IMU_MAG_Y_SENS 5.50667355203
#define IMU_MAG_Y_SENS_NUM 63949
#define IMU_MAG_Y_SENS_DEN 11613
#define IMU_MAG_Z_SENS 4.84234601901
#define IMU_MAG_Z_SENS_NUM 29640
#define IMU_MAG_Z_SENS_DEN 6121
#define IMU_BODY_TO_IMU_PHI 0.
#define IMU_BODY_TO_IMU_THETA 0.
#define IMU_BODY_TO_IMU_PSI 0.

#define SECTION_AHRS 1
#define AHRS_PROPAGATE_LOW_PASS_RATES 1
#define AHRS_GRAVITY_HEURISTIC_FACTOR 30
#define AHRS_H_X 0.512952860966861
#define AHRS_H_Y -0.060205545548511
#define AHRS_H_Z 0.856302898934226

#define SECTION_INS 1

#define SECTION_STABILIZATION_RATE 1
#define STABILIZATION_RATE_SP_MAX_P 10000
#define STABILIZATION_RATE_SP_MAX_Q 10000
#define STABILIZATION_RATE_SP_MAX_R 10000
#define STABILIZATION_RATE_DEADBAND_P 20
#define STABILIZATION_RATE_DEADBAND_Q 20
#define STABILIZATION_RATE_DEADBAND_R 200
#define STABILIZATION_RATE_REF_TAU 4
#define STABILIZATION_RATE_GAIN_P 400
#define STABILIZATION_RATE_GAIN_Q 400
#define STABILIZATION_RATE_GAIN_R 350
#define STABILIZATION_RATE_IGAIN_P 75
#define STABILIZATION_RATE_IGAIN_Q 75
#define STABILIZATION_RATE_IGAIN_R 50
#define STABILIZATION_RATE_DDGAIN_P 300
#define STABILIZATION_RATE_DDGAIN_Q 300
#define STABILIZATION_RATE_DDGAIN_R 110

#define SECTION_STABILIZATION_ATTITUDE 1
#define STABILIZATION_ATTITUDE_SP_MAX_PHI 0.7853981625
#define STABILIZATION_ATTITUDE_SP_MAX_THETA 0.7853981625
#define STABILIZATION_ATTITUDE_SP_MAX_R 1.570796325
#define STABILIZATION_ATTITUDE_DEADBAND_A 0
#define STABILIZATION_ATTITUDE_DEADBAND_E 0
#define STABILIZATION_ATTITUDE_DEADBAND_R 250
#define STABILIZATION_ATTITUDE_REF_OMEGA_P 6.981317
#define STABILIZATION_ATTITUDE_REF_ZETA_P 0.85
#define STABILIZATION_ATTITUDE_REF_MAX_P 6.981317
#define STABILIZATION_ATTITUDE_REF_MAX_PDOT RadOfDeg(8000.)
#define STABILIZATION_ATTITUDE_REF_OMEGA_Q 6.981317
#define STABILIZATION_ATTITUDE_REF_ZETA_Q 0.85
#define STABILIZATION_ATTITUDE_REF_MAX_Q 6.981317
#define STABILIZATION_ATTITUDE_REF_MAX_QDOT RadOfDeg(8000.)
#define STABILIZATION_ATTITUDE_REF_OMEGA_R 4.363323125
#define STABILIZATION_ATTITUDE_REF_ZETA_R 0.85
#define STABILIZATION_ATTITUDE_REF_MAX_R 1.570796325
#define STABILIZATION_ATTITUDE_REF_MAX_RDOT RadOfDeg(180.)
#define STABILIZATION_ATTITUDE_PHI_PGAIN 1961
#define STABILIZATION_ATTITUDE_PHI_DGAIN 515
#define STABILIZATION_ATTITUDE_PHI_IGAIN 582
#define STABILIZATION_ATTITUDE_THETA_PGAIN 1961
#define STABILIZATION_ATTITUDE_THETA_DGAIN 515
#define STABILIZATION_ATTITUDE_THETA_IGAIN 582
#define STABILIZATION_ATTITUDE_PSI_PGAIN 506
#define STABILIZATION_ATTITUDE_PSI_DGAIN 307
#define STABILIZATION_ATTITUDE_PSI_IGAIN 21
#define STABILIZATION_ATTITUDE_PHI_DDGAIN 300
#define STABILIZATION_ATTITUDE_THETA_DDGAIN 300
#define STABILIZATION_ATTITUDE_PSI_DDGAIN 1000

#define SECTION_GUIDANCE_V 1
#define GUIDANCE_V_REF_MIN_ZDD -0.2*9.81
#define GUIDANCE_V_REF_MAX_ZDD 0.2*9.81
#define GUIDANCE_V_REF_MIN_ZD -3.
#define GUIDANCE_V_REF_MAX_ZD 3.
#define GUIDANCE_V_HOVER_KP 120
#define GUIDANCE_V_HOVER_KD 120
#define GUIDANCE_V_HOVER_KI 40
#define GUIDANCE_V_RC_DESCENT_COEF 200

#define SECTION_GUIDANCE_H 1
#define GUIDANCE_H_USE_REF 1
#define GUIDANCE_H_USE_SPEED_REF 1
#define GUIDANCE_H_MAX_BANK 0.4712388975
#define GUIDANCE_H_REF_MAX_ACCEL 7.
#define GUIDANCE_H_REF_MAX_SPEED 2.
#define GUIDANCE_H_RC_SPEED_DEAD_BAND 200000
#define GUIDANCE_H_PGAIN 100
#define GUIDANCE_H_DGAIN 120
#define GUIDANCE_H_IGAIN 10
#define GUIDANCE_H_AGAIN 10

#define SECTION_SIMULATOR 1
#define NPS_ACTUATOR_NAMES {"front_motor", "back_motor", "right_motor", "left_motor"}
#define NPS_JSBSIM_INIT "reset00"
#define NPS_JSBSIM_MODEL "simple_quad"
#define NPS_SENSORS_PARAMS "nps_sensors_params_default.h"

#define SECTION_AUTOPILOT 1
#define MODE_MANUAL AP_MODE_ATTITUDE_DIRECT
#define MODE_AUTO1 AP_MODE_ATTITUDE_Z_HOLD
#define MODE_AUTO2 AP_MODE_FAILSAFE

#define SECTION_BAT 1
#define CRITIC_BAT_LEVEL 10.1
#define LOW_BAT_LEVEL 11.1
#define MAX_BAT_LEVEL 12.7


#endif // AIRFRAME_H
